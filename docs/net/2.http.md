# 2. HTTP协议

## 2.1 HTTP报文的构成

### 2.1.1 请求报文
请求头：请求方法 + 请求URI + 协议版本
请求首部字段

内容实体

例如
```
POST /form/entry HTTP/1.1
Host: www.baidu.com
Connection: keep-alive
Content-Type: applicecation/x-www-form-urlencoded
Content-Length: 16

name=useo&age=37
```

### 2.1.2 响应报文
响应头：协议版本 状态码 状态码的原因短语
响应首部字段

内容实体

例如
```
HTTP/1.1 200 OK
Date: Tue, 10 Jul 2012 06:50:15 GMT
Content-Type: text/html
Content-Length: 362

<html>...</html>
```
 
## 2.2 HTTP报文首部字段
分为4种类型：

### 通用首部字段

#### Cache-Control

Cache-Control 操作缓存的工作机制

Cache-Control指令：

+ public: 其他用户也可利用缓存
+ private: 只给特定的用户缓存
+ no-cache: 防止从缓存中返回过期内容，不进行缓存
+ no-store: 暗示请求或响应中包含机密信息，不缓存。
+ s-maxage: 指定缓存有效期，供给多位用户使用的供给缓存服务器使用，使用后直接忽略Expires、max-age
+ max-age: 指定缓存有效期，使用后忽略Expires
+ min-fresh: 在指定时间以内如果有超过有效期限的资源都无法返回
+ max-stale: 在指定时间以内接收过期的缓存资源。
+ only-if-cached: 仅在缓存服务器本地缓存目标资源的情况下才返回。
+ must-revalidate: 代理会向源服务器再次验证即将返回的响应缓存目前是否有效。
+ proxy-revalidate: 要求缓存服务器在接收到客户端请求，返回响应之前，必须再次验证缓存的有效性
+ no-transform: 保证缓存不能改变实体主体的媒体类型。防止缓存或代理压缩图片。

Connectyion 指令:
### 请求首部字段

### 响应首部字段

### 实体首部字段

## 2.3 HTTP无状态

HTTP是不保存状态的协议即无状态协议。

为了更快的处理大量的事务，确保协议的可伸缩性，而特意把HTTP设计成如此简单。

无状态缺点：用户登录到一家购物网站，即使他跳到该网站的其他页面也要保持登录状态，如果无状态的话那么每到一个页面都要重新登录。
针对这种情况就需要保存用户的状态。

HTTP/1.1虽然是无状态的，但是为了实现保存状态，于是引入的cookie技术。有了cookie在用HTTP协议通信就可以管理状态了。

## 2.4 HTTP方法

GET：获取资源
POST：传输实体主体
PUT:传输文件。该方法任何人都可以上次文件，存在安全性问题。除非使用验证机制或REST标准，就可能开发使用。
HEAD: 获取报文首部
DELETE：删除资源
OPTIONS: 询问支持的方法
TRACE: 追踪路径
CONNECT:要求用隧道协议连接代理

## 2.5 HTTP持久连接

HTTP初始版本每通信一次都要断开一次TCP，随着HTTP的普及，文档中包含着大量图片。
比如一个浏览器浏览多张图片的HTML页面，在发送HTML页面资源的同时，也会请求该HTML页面里的其他资源。
因此，每次的请求都会造成无谓的TCP建立和断开
增加通信量的开销。

### 2.4.1 特点

1. 一方没有提出断开连接，则保持TCP连接状态
2. 在HTTP/1.1 默认持久连接。

## 2.6 压缩提升传输速率

常用的内容编码如下：

+ gzip(GUN zip)
+ deflate(zlib)
+ identity(不编码)

## 2.7 发送多种数据的多部分集合

多部分对象集合包含的对象如下：

+ Content-Type: multipart/form-data: 在web表单上传时使用
+ Content-Type: multipart/byteranges：响应报文包含了多个范围的内容时使用

## 2.8 范围请求

```
Range: bytes= 5001-6000
```

## 2.9 内容协商

当浏览器默认语言为英文或中文，访问相同URI的web页面时，则会显示对于的英文或中文版页面。这样的机制称为内容协商。
协商类型：服务器协商、客户端协商、透明协商（服务端、客户端混合）

以下首部字段就是判断的基准

Accept:
Accept-Charset:
Accept-Encoding:
Accept-Language:

## 2.10 HTTP 状态码

### 1xx
  请求正在处理

### 2xx：请求成功
  200: 客户端请求被服务端成功处理并返回数据。
  204：客户端请求被服务端成功处理但未返回数据。
  206：客户端使用Content-Range进行范围请求，被服务端成功处理并返回数据。

### 3xx: 重定向
  301：永久重定向，表示资源已经被分配了新的URL
  302：临时重定向，表示资源临时分配到了新的URL
  303：表示资源存在着另一个URL，需要用GET方法请求
  304：表示协商缓存命中时，返回该状态码
  307：临时重定向

### 4xx: 客户端错误
  400：表示客户端请求地址或者请求参数错误
  401：表示发送的请求需要通过HTTP认证的认证信息
  403：表示请求被服务器拒绝。
  404：表示服务器没有找到该资源
  405：表示服务器不接受该请求方法

### 5xx: 服务端错误
  500：表示服务端执行请求时发生了错误
  503：表示服务器暂时处于超负荷或停止服务
